StoreLocator={defaultOptions:{getStoresUri:"",markerIcon:"",useCustomInfoBox:false,maxResultItemsOriginal:10,maxRadius:2e3},run:function(e){this._initializeOptions(e);this._initializeMap();this._initializeRadius();this._initializeMarkers();this._attachEvents();this._initializeInfoWindow();this._initializeToggleMap();if(this.options.displayMode=="storeSearch"){this._initializeMapPosition();this._searchLocations()}if(this.options.displayMode=="directionsService"){this._initializeDefaultLocation();this._initializeDirectionService()}},_initializeRadius:function(){if($("#location_radius").is("select")){this.radius=parseInt($("#location_radius option:selected").val())}else{this.radius=parseInt($("#location_radius").val())}},_startSearch:function(e){this._searchLocations();e.preventDefault();return false},_searchLocations:function(){var e=$("#location").val();var t=$("#location_country").length?$("#location_country").val():0;if(e!=""){this._showIndicator();if(this.userLocation&&this.lastQueryAddress==e){this._loadLocations(this.userLocation.lat(),this.userLocation.lng(),t)}else{this._firstSearchWithoutUserLocationData(e,t)}}else{if(this.options.activate.mainstore){this._findMainStoreLocations()}else{this._hideIndicator()}}},_firstSearchWithoutUserLocationData:function(e,t){var n=new google.maps.Geocoder;var r=this;this.lastQueryAddress=e;n.geocode({address:e,region:this.options.region},function(n,i){if(i==google.maps.GeocoderStatus.OK){r.userLocation=n[0].geometry.location;r._loadLocations(r.userLocation.lat(),r.userLocation.lng(),t)}else{r._noResultsFound(e);$("[data-showOnResponse]").show()}})},_findMainStoreLocations:function(){this._clearAllLocations();var e=this;var t=this.options.getDefaultStoresUri;$.ajax({type:"GET",url:t,dataType:"json",success:function(t){e._initializeAndOutputLocations(t)},error:function(e,t,n){console.log(t,n)}})},_loadLocations:function(e,t,n){var r=this;var i=this.options.getStoresUri;i=i.replace("_LATITUDE_",e);i=i.replace("_LONGITUD_",t);i=i.replace("_RADIUS_",this.radius);i=i.replace("_COUNTRY_",n);$.ajax({type:"GET",url:i,dataType:"json",success:function(e){r._initializeAndOutputLocations(e)},error:function(e,t,n){console.log(t,n)}})},_initializeAndOutputLocations:function(e){var t=this;var n=e.locations;var r=e.sidebarItems;var i=e.markerContent;var s=new google.maps.LatLngBounds;var o=$("#sidebar").eq(0);var u=$("#location").val();o.innerHTML="";this._clearAllLocations();if(n.length>0){if(this.options.activate.automaticellyIncreaseRadius){if(n.length<this.options.automaticallyIncreaseRadiusMaxResultItems&&this.radius<this.options.maxRadius){t._increaseRadius();return}}if(n.length>this.options.maxResultItems){t._showMoreButton()}else{t._hideMoreButton()}for(var a=0;a<n.length;a++){if(a>this.options.maxResultItems-1)break;var f=new google.maps.LatLng(parseFloat(n[a]["latitude"]),parseFloat(n[a]["longitude"]));o.append($(r[a]));t._createLocationMarker(i[a],n[a],f,false);s.extend(f)}t.map.fitBounds(s);this._hideIndicator();$("[data-showOnSuccess]").show()}else{if(this.options.activate.automaticellyIncreaseRadius&&this.radius<this.options.maxRadius){t._increaseRadius()}else{t._noResultsFound(u)}}$("[data-showOnResponse]").show()},_increaseRadius:function(){this.radius=this.radius+parseInt(this.options.defaultRadius);this._searchLocations()},_clearAllLocations:function(){$("[data-showOnSuccess]").hide();$("[data-queryresult]").remove();this.infoWindow.close();for(var e=0;e<this.markers.length;e++){this.markers[e].setMap(null)}this.markers.length=0},_calculateDirectionRoute:function(e){var t=this;var n=$("#from-street").val();var r=$("#from-zip").val();var i=$("#from-city").val();var s=$("#directions-headline");if(n||r||i){$("#directions-panel").html("");s.hide();this._showIndicator();this.infoWindow.close();var o={origin:n+","+r+", "+i+", "+this.options.region,destination:this.options.defaultStore.locations[0].address,travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC};this.directionsService.route(o,function(e,o){if(o==google.maps.DirectionsStatus.OK){s.show();t.directionsDisplay.setDirections(e)}else{t._noResultsFound(r+" "+i+" "+n)}t._hideIndicator()})}e.preventDefault();return false},_initializeDefaultLocation:function(){var e=this.options.defaultStore.locations;var t=this.options.defaultStore.markerContent;var n=new google.maps.LatLng(parseFloat(e[0]["latitude"]),parseFloat(e[0]["longitude"]));this._createLocationMarker(t[0],e[0],n,true);this.map.setCenter(n);this.map.setZoom(15);this.map.panBy(0,-50);this._hideIndicator()},_initializeDirectionService:function(){this.directionsService=new google.maps.DirectionsService;this.directionsDisplay=new google.maps.DirectionsRenderer;this.directionsDisplay.setMap(this.map);this.directionsDisplay.setPanel($("#directions-panel").get(0))},_initializeOptions:function(e){this.options=$.extend({},this.defaultOptions,e);this.options.maxResultItemsOriginal=this.options.maxResultItems},_initializeMap:function(){var e={maxZoom:15,panControl:true,zoomControl:true,scaleControl:false,disableDefaultUI:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};this.map=new google.maps.Map($("#map").get(0),e)},_initializeMapPosition:function(){var e=this;var t=new google.maps.Geocoder;var n=this.options.region=="europa"?3:6;t.geocode({address:this.options.region,region:this.options.region},function(t,r){if(r==google.maps.GeocoderStatus.OK){e.map.setCenter(t[0].geometry.location);e.map.setZoom(n)}})},_initializeMarkers:function(){this.markers=[]},_initializeInfoWindow:function(){this.infoWindow=new StoreLocatorInfoWindow(this.options.useCustomInfoBox)},_createLocationMarker:function(e,t,n,r){var i=this;if(i.options.markerIcon!=""){var s=i.options.markerIcon}var o=new google.maps.Marker({map:i.map,position:n,icon:s,animation:google.maps.Animation.DROP});var u=e;google.maps.event.addListener(o,"click",function(){i.infoWindow.setContent(u);i.infoWindow.open(i.map,o)});if(r){i.infoWindow.setContent(u);i.infoWindow.open(i.map,o)}$("#storeLocatorMarker_"+t["uid"]).bind("click",function(){i.infoWindow.setContent(u);i.infoWindow.open(i.map,o);return false});i.markers.push(o)},_attachEvents:function(){var e=$(document.body);e.on("click",".storeSearch #searchButton",$.proxy(function(e){this.options.maxResultItems=this.options.maxResultItemsOriginal;this._hideMoreButton();$("[data-showOnResponse]").hide();this._clearAllLocations();this._initializeRadius();this._startSearch(e);this._clearNotification()},this));e.on("click",".directionsService #searchButton",$.proxy(function(e){this._calculateDirectionRoute(e);this._clearNotification()},this));e.on("click",".storeSearch #more-button",$.proxy(function(e){this.options.maxResultItems=this.options.maxResultItems+this.options.maxResultItems;this._hideMoreButton();$("[data-showOnResponse]").hide();this._startSearch(e);this._clearAllLocations();this._initializeRadius();this._clearNotification()},this))},_initializeToggleMap:function(){var e=this;var t=$("#retailer_search");var n=t.find(".map-container");var r=n.height();var i=t.find(".js-toggle-map");var s=i.find("span");var o=s.text();var u=i.attr("data-text-open");i.bind("click",function(){if(!n.is(":animated")){if(i.hasClass("closed")){n.animate({height:r},500);s.html(o);e._showIndicator()}else{n.animate({height:0},500,function(){e._hideIndicator()});s.html(u)}i.toggleClass("closed")}return false})},_noResultsFound:function(e){var t=this.options.labels.notificationNoDealerFound.replace("_KEYWORD_",e);$("#notification").html(t);this._hideIndicator()},_clearNotification:function(){$("#notification").html("")},_hideIndicator:function(){$(".progress-indicator").hide()},_showIndicator:function(){$(".progress-indicator").show()},_hideMoreButton:function(){$("[data-showMoreButton]").hide()},_showMoreButton:function(){$("[data-showMoreButton]").show()}}
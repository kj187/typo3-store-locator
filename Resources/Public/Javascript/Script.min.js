StoreLocator={defaultOptions:{getStoresUri:"",markerIcon:"",useCustomInfoBox:false,maxResultItemsOriginal:10,maxRadius:50000},run:function(a){this._initializeOptions(a);this._initializeMap();this._initializeRadius();this._initializeMarkers();this._attachEvents();this._initializeInfoWindow();this._initializeToggleMap();if(this.options.displayMode=="storeSearch"){this._initializeMapPosition();this._searchLocations()}if(this.options.displayMode=="directionsService"){this._initializeDefaultLocation();this._initializeDirectionService()}},_initializeRadius:function(){if($("#location_radius").is("select")){this.radius=parseInt($("#location_radius option:selected").val())}else{this.radius=parseInt($("#location_radius").val())}},_startSearch:function(a){this._searchLocations();a.preventDefault();return false},_searchLocations:function(){var a=$("#location").val();var b=($("#location_country").length?$("#location_country").val():0);if(a!=""){if(this.userLocation&&this.lastQueryAddress==a){this._loadLocations(this.userLocation.lat(),this.userLocation.lng(),b)}else{this._firstSearchWithoutUserLocationData(a,b)}}else{if(this.options.activate.mainstore){this._findMainStoreLocations()}}},_firstSearchWithoutUserLocationData:function(a,d){var c=new google.maps.Geocoder();var b=this;this.lastQueryAddress=a;c.geocode({address:a,region:this.options.region},function(f,e){if(e==google.maps.GeocoderStatus.OK){b.userLocation=f[0].geometry.location;b._loadLocations(b.userLocation.lat(),b.userLocation.lng(),d)}else{b._noResultsFound(a)}})},_findMainStoreLocations:function(){this._clearAllLocations();var a=this;var b=this.options.getDefaultStoresUri;$.ajax({type:"GET",url:b,dataType:"json",success:function(c){a._initializeAndOutputLocations(c)}})},_loadLocations:function(c,b,e){var a=this;var d=this.options.getStoresUri;d=d.replace("_LATITUDE_",c);d=d.replace("_LONGITUD_",b);d=d.replace("_RADIUS_",this.radius);d=d.replace("_COUNTRY_",e);$.ajax({type:"GET",url:d,dataType:"json",success:function(f){a._initializeAndOutputLocations(f)}})},_initializeAndOutputLocations:function(e){var m=this;var h=e.locations;var g=e.sidebarItems;var j=e.markerContent;var b=new google.maps.LatLngBounds();var a=$("#sidebar").eq(0);var f=$("#more-button");var l=$("#location").val();a.innerHTML="";if(h.length>0){if(this.options.activate.automaticellyIncreaseRadius){if(h.length<this.options.automaticallyIncreaseRadiusMaxResultItems&&this.radius<this.options.maxRadius){m._increaseRadius();return}}if(h.length>this.options.maxResultItems){f.show()}else{f.hide()}for(var d=0;d<h.length;d++){if(d>(this.options.maxResultItems-1)){break}var c=new google.maps.LatLng(parseFloat(h[d]["latitude"]),parseFloat(h[d]["longitude"]));var k=m._createSidebarItem($(g[d]),h[d]);a.append(k);m._createLocationMarker(j[d],h[d],c,false);b.extend(c)}m.map.fitBounds(b)}else{if(this.options.activate.automaticellyIncreaseRadius&&this.radius<this.options.maxRadius){m._increaseRadius()}else{m._noResultsFound(l)}}},_increaseRadius:function(){this.radius=(this.radius+parseInt(this.options.defaultRadius));this._searchLocations()},_createSidebarItem:function(c,a){var b=$("<li/>");b.append(c);return b},_clearAllLocations:function(){$("#sidebar").html("");this.infoWindow.close();for(var a=0;a<this.markers.length;a++){this.markers[a].setMap(null)}this.markers.length=0},_calculateDirectionRoute:function(f){var a=this;var g=$("#from-street").val();var c=$("#from-zip").val();var b=$("#from-city").val();if(g||c||b){this.infoWindow.close();var d={origin:g+","+c+", "+b+", "+this.options.region,destination:this.options.defaultStore.locations[0].address,travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC};this.directionsService.route(d,function(h,e){if(e==google.maps.DirectionsStatus.OK){a.directionsDisplay.setDirections(h)}else{a._noResultsFound(c+" "+b+" "+g)}})}f.preventDefault();return false},_initializeDefaultLocation:function(){var a=this.options.defaultStore.locations;var b=this.options.defaultStore.markerContent;var c=new google.maps.LatLng(parseFloat(a[0]["latitude"]),parseFloat(a[0]["longitude"]));this._createLocationMarker(b[0],a[0],c,true);this.map.setCenter(c);this.map.setZoom(15)},_initializeDirectionService:function(){this.directionsService=new google.maps.DirectionsService();this.directionsDisplay=new google.maps.DirectionsRenderer();this.directionsDisplay.setMap(this.map);this.directionsDisplay.setPanel($("#directions-panel").get(0))},_initializeOptions:function(a){this.options=$.extend({},this.defaultOptions,a);this.options.maxResultItemsOriginal=this.options.maxResultItems},_initializeMap:function(){var a={maxZoom:15,panControl:true,zoomControl:true,scaleControl:false,disableDefaultUI:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};this.map=new google.maps.Map($("#map").get(0),a)},_initializeMapPosition:function(){var a=this;var c=new google.maps.Geocoder;var b=(this.options.region=="europa"?3:6);c.geocode({address:this.options.region,region:this.options.region},function(e,d){if(d==google.maps.GeocoderStatus.OK){a.map.setCenter(e[0].geometry.location);a.map.setZoom(b)}})},_initializeMarkers:function(){this.markers=[]},_initializeInfoWindow:function(){this.infoWindow=new StoreLocatorInfoWindow(this.options.useCustomInfoBox)},_createLocationMarker:function(f,b,h,g){var c=this;if(c.options.markerIcon!=""){var e=c.options.markerIcon}var a=new google.maps.Marker({map:c.map,position:h,icon:e,animation:google.maps.Animation.DROP});var d=f;google.maps.event.addListener(a,"click",function(){c.infoWindow.setContent(d);c.infoWindow.open(c.map,a)});if(g){c.infoWindow.setContent(d);c.infoWindow.open(c.map,a)}$("#storeLocatorMarker_"+b.uid).bind("click",function(){c.infoWindow.setContent(d);c.infoWindow.open(c.map,a);return false});c.markers.push(a)},_attachEvents:function(){var a=$(document.body);a.on("change",".storeSearch #location_country",$.proxy(function(b){this._clearAllLocations();this._initializeRadius();this._startSearch(b);this._clearNotification()},this));a.on("click",".storeSearch #searchButton",$.proxy(function(b){this.options.maxResultItems=this.options.maxResultItemsOriginal;this._clearAllLocations();this._initializeRadius();this._startSearch(b);this._clearNotification()},this));a.on("click",".directionsService #searchButton",$.proxy(function(b){this._calculateDirectionRoute(b);this._clearNotification()},this));a.on("click",".storeSearch #more-button",$.proxy(function(b){this.options.maxResultItems=(this.options.maxResultItems+this.options.maxResultItems);this._startSearch(b);this._initializeRadius();this._clearNotification()},this))},_initializeToggleMap:function(){var c=$("#retailer_search");var d=c.find(".google-map");var g=d.height();var f=c.find(".js-toggle-map");var a=f.find("span");var b=a.text();var e=f.attr("data-text-open");f.bind("click",function(){if(!d.is(":animated")){if(f.hasClass("closed")){d.animate({height:g},500);a.html(b)}else{d.animate({height:0},500);a.html(e)}f.toggleClass("closed")}return false})},_noResultsFound:function(b){var a=this.options.labels.notificationNoDealerFound.replace("_KEYWORD_",b);$("#notification").html(a)},_clearNotification:function(){$("#notification").html("")}};